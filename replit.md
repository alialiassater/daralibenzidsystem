# نظام إدارة المطبعة ودار النشر

## نظرة عامة
تطبيق ويب متكامل لإدارة مطبعة ودار نشر "دار علي بن زيد للطباعة والنشر" بواجهة عربية 100% مع دعم الباركود وصور الأغلفة.

## التقنيات المستخدمة
- **Frontend**: React + TypeScript + Vite + Tailwind CSS + Shadcn UI
- **Backend**: Node.js + Express
- **Database**: PostgreSQL (Drizzle ORM)
- **Barcode**: JsBarcode للتوليد
- **File Upload**: Multer لرفع صور الأغلفة
- **Currency**: دينار جزائري (د.ج)

## الميزات الرئيسية

### 1. المستخدمون والصلاحيات
- تسجيل دخول عربي
- **ثلاث رتب**: مدير، مشرف، موظف
- **صفحة إدارة الموظفين**: إضافة، تعديل، تعطيل الموظفين (للمدير فقط)
- **تغيير كلمة المرور**: المدير يمكنه تغيير كلمة مرور أي موظف (مع تشفير SHA-256)
- **تقييد الوصول للصفحات حسب الرتبة**
- تعطيل المستخدم بدلاً من حذفه نهائياً

### 2. إدارة المخزون + باركود
- إضافة مواد جديدة (ورق، حبر، غلاف، كتاب)
- توليد باركود تلقائي لكل مادة
- طباعة الباركود
- مسح الباركود يدوياً
- تسجيل حركات الدخول/الخروج
- تنبيهات المخزون المنخفض
- **حذف منطقي (Soft Delete)**: لا يتم حذف المادة نهائياً
- **تقييد الحذف**: المواد ذات الحركات تتطلب صلاحية المدير

### 3. إدارة طلبات الطباعة
- إضافة طلبات جديدة
- تتبع حالة الطلب
- أنواع طباعة متعددة

### 4. إدارة دار النشر (الكتب)
- إضافة كتب مع ISBN وباركود
- **تعديل الكتب الكامل**: (الاسم، المؤلف، ISBN، الصنف، الكميات، السعر) مع التحقق من تفرد ISBN
- **صور الأغلفة**: رفع وعرض صور أغلفة الكتب
- **تصنيف الكتب**: (تعليمي، ديني، أدبي، علمي، أطفال، تاريخي، فلسفي، شعر، رواية، قصص قصيرة، مسرحيات، أخرى)
- **نظام الكميات والحالة**:
  • الكمية الإجمالية
  • الكمية الجاهزة
  • الكمية قيد الطباعة
  • حالة الكتاب (جاهز – قيد الطباعة – غير متوفر)
- تحديث الحالة تلقائياً حسب الكميات
- منع تسجيل كمية جاهزة أكبر من الكمية الإجمالية
- البحث والتصفية حسب الصنف
- **حذف منطقي (Soft Delete)**: للمدير فقط، لا يتم حذف الكتاب نهائياً

### 5. لوحة التحكم
- إحصائيات شاملة (المخزون، الطلبات، الكتب، المصروفات)
- **كرت الكتب الجاهزة**: قابل للتوسيع - عدد الكتب الجاهزة + مجموع الكميات الجاهزة مع قائمة
- **كرت طلبات الطباعة**: قابل للتوسيع - يعرض قائمة الطلبات مع (اسم العميل، نوع الطباعة، الكمية، الحالة)
- رسوم بيانية لحالة الطلبات
- تنبيهات المخزون المنخفض
- **التنقل السريع**: الضغط على أي طلب/كتاب في القائمة يفتح صفحة التفاصيل مباشرة

### 6. سجل النشاط (Activity Logs) - للمدير فقط
- تسجيل جميع العمليات تلقائياً (دخول، خروج، إضافة، تعديل، حذف)
- **معلومات السجل**: اسم المستخدم، الرتبة، نوع العملية، الكيان المتأثر، التفاصيل، عنوان IP، التاريخ والوقت
- **أنواع العمليات**: login, logout, create, update, delete, inventory_in, inventory_out
- **أنواع الكيانات**: auth, user, material, book, order, inventory_movement
- **تصفية متقدمة**: بحث بالنص، فلترة بالموظف، فلترة بنوع العملية، فلترة بنوع الكيان
- **الأمان**: التحقق من صلاحية المدير على مستوى الخادم (x-user-role header)

## هيكل المشروع

```
client/
├── src/
│   ├── components/
│   │   ├── app-sidebar.tsx        # القائمة الجانبية
│   │   ├── barcode-generator.tsx  # مولد الباركود
│   │   ├── barcode-scanner.tsx    # ماسح الباركود
│   │   └── theme-toggle.tsx       # تبديل الوضع
│   ├── lib/
│   │   └── auth-context.tsx       # سياق المصادقة
│   ├── pages/
│   │   ├── dashboard.tsx          # لوحة التحكم
│   │   ├── inventory.tsx          # المخزون
│   │   ├── orders.tsx             # الطلبات
│   │   ├── books.tsx              # الكتب
│   │   ├── employees.tsx          # الموظفون
│   │   ├── activity-logs.tsx      # سجل النشاط
│   │   └── login.tsx              # تسجيل الدخول
│   └── App.tsx                    # التطبيق الرئيسي
server/
├── db.ts                          # اتصال قاعدة البيانات
├── index.ts                       # نقطة الدخول + خدمة الملفات
├── routes.ts                      # API endpoints
└── storage.ts                     # طبقة التخزين
shared/
└── schema.ts                      # مخطط قاعدة البيانات
uploads/
└── covers/                        # صور أغلفة الكتب
```

## API Endpoints

### المصادقة
- `POST /api/auth/login` - تسجيل الدخول

### المستخدمون
- `GET /api/users` - جلب جميع المستخدمين
- `POST /api/users` - إضافة مستخدم جديد
- `PATCH /api/users/:id` - تحديث بيانات المستخدم
- `PATCH /api/users/:id/toggle-active` - تفعيل/تعطيل المستخدم
- `PATCH /api/users/:id/password` - تغيير كلمة المرور (للمدير فقط)

### المخزون
- `GET /api/materials` - جلب جميع المواد
- `POST /api/materials` - إضافة مادة جديدة
- `DELETE /api/materials/:id` - حذف مادة (Soft Delete)
- `GET /api/materials/:barcode` - جلب مادة بالباركود
- `GET /api/inventory-movements` - جلب حركات المخزون
- `POST /api/inventory-movements` - تسجيل حركة

### الطلبات
- `GET /api/orders` - جلب جميع الطلبات
- `POST /api/orders` - إضافة طلب جديد
- `PATCH /api/orders/:id/status` - تحديث حالة الطلب
- `DELETE /api/orders/:id` - حذف طلب (Soft Delete - للمدير فقط)

### الكتب
- `GET /api/books` - جلب جميع الكتب
- `POST /api/books` - إضافة كتاب جديد
- `POST /api/books/:id/cover` - رفع صورة غلاف (Multer)
- `PATCH /api/books/:id/quantities` - تحديث كميات الكتاب
- `PATCH /api/books/:id` - تعديل بيانات الكتاب الكاملة (مع التحقق من تفرد ISBN)
- `DELETE /api/books/:id` - حذف كتاب (Soft Delete - للمدير فقط)

### المصروفات
- `GET /api/expenses` - جلب المصروفات
- `POST /api/expenses` - إضافة مصروف

### لوحة التحكم
- `GET /api/dashboard/stats` - إحصائيات اللوحة

### سجل النشاط (للمدير فقط)
- `GET /api/activity-logs` - جلب سجلات النشاط مع دعم التصفية

## بيانات الدخول التجريبية
- المستخدم: `admin`
- كلمة المرور: `admin123`

## التشغيل
```bash
npm run dev
```

## التصميم المتجاوب (Responsive Design)
- دعم كامل للهواتف والتابلت
- **Mobile-First**: تصميم يبدأ من الشاشات الصغيرة
- **الجداول**: قابلة للتمرير أفقياً مع إخفاء بعض الأعمدة
- **الأزرار**: حجم مناسب للمس (44px كحد أدنى)
- **الشبكات**: تتكيف تلقائياً مع حجم الشاشة
- **العناوين**: أحجام متجاوبة (text-2xl على الموبايل، text-3xl على الشاشات الكبيرة)

## التاريخ
- 2026-01-22: الإصدار الأول - نظام متكامل مع RTL ودعم الباركود
- 2026-01-22: إضافة صور الأغلفة وتصنيفات الكتب، حذف نظام المبيعات
- 2026-01-22: إضافة نظام الرتب والصلاحيات، صفحة إدارة الموظفين، حذف منطقي للمخزون
- 2026-01-22: إضافة دعم الهواتف والتصميم المتجاوب
- 2026-01-23: إضافة نظام سجل النشاط الشامل مع تتبع جميع العمليات والتصفية المتقدمة
- 2026-01-23: إضافة تعديل بيانات الكتب الكامل مع التحقق من ISBN، تغيير كلمة المرور للموظفين (للمدير فقط)، حذف منطقي للكتب والطلبات
- 2026-01-23: تحسين كرت طلبات الطباعة في لوحة التحكم - إضافة قائمة قابلة للتوسيع مع تفاصيل الطلبات والتنقل السريع
